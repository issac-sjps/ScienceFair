<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å£èªªæŒ‘æˆ° - å¯éŒ„éŸ³ç‰ˆ</title>
<style>
body{font-family:'Segoe UI',sans-serif;background:#0b1220;color:#fff;text-align:center;margin:0;padding:0;display:flex;flex-direction:column;align-items:center;}
.header{width:100%;padding:16px;background:rgba(255,255,255,0.05);backdrop-filter:blur(8px);}
.header h1{margin:0 0 8px 0;}
.stats{display:flex;gap:16px;justify-content:center;}
button{padding:10px 20px;margin:4px;font-size:18px;border:none;border-radius:10px;background:linear-gradient(90deg,#6366f1,#a78bfa);color:#fff;cursor:pointer;}
button:disabled{opacity:0.6;cursor:not-allowed;}
#clue{margin:16px 0;font-size:20px;}
#feedback{margin:12px;font-size:18px;}
#rankBoard{width:90%;background:rgba(0,0,0,0.6);border-radius:12px;padding:0 0 12px 0;margin-top:12px;max-height:200px;overflow-y:auto;transition:max-height 0.3s;}
#rankBoard.collapsed{max-height:40px;overflow:hidden;}
#rankBoard h3{margin:0;padding:8px 12px;font-size:22px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;}
#rankList{list-style:none;padding:0;margin:0;}
#rankList li{padding:4px 12px;}
.result{font-size:22px;margin-top:12px;padding:8px 16px;border-radius:10px;}
.result.good{background:rgba(34,197,94,0.15);color:#22c55e;}
.result.bad{background:rgba(239,68,68,0.15);color:#ef4444;}
footer{width:100%;padding:12px;background:rgba(0,0,0,0.3);backdrop-filter:blur(8px);}
</style>
</head>
<body>

<div class="header">
<h1>å£èªªæŒ‘æˆ° - å¯éŒ„éŸ³ç‰ˆ</h1>
<div class="stats">åˆ†æ•¸ï¼š<span id="score">0</span> | ç­”å°ç‡ï¼š<span id="accuracy">0</span>%</div>
<div id="clue">è«‹æŒ‰ã€Œé–‹å§‹æŒ‘æˆ°ã€</div>
</div>

<div>
<button id="startBtn">é–‹å§‹æŒ‘æˆ°</button>
<button id="recBtn">æŒ‰ä¸‹èªªè©±</button>
<button id="nextBtn">ä¸‹ä¸€é¡Œ</button>
<button id="playRef">æ’­æ”¾å–®å­—</button>
</div>

<div id="feedback"></div>

<div id="rankBoard" class="collapsed">
<h3>ğŸ† æ’è¡Œæ¦œ <span id="toggleRank">ğŸ“Œ</span></h3>
<ol id="rankList"></ol>
</div>

<footer>â±ï¸ å£èªªæŒ‘æˆ° â€” iPad å…¨è¢å¹•</footer>

<script>
const qa=[
  {prompt:'ç£éµ', answer:'magnet'},
  {prompt:'åŒ—æ¥µ', answer:'north pole'},
  {prompt:'å—æ¥µ', answer:'south pole'},
  {prompt:'æ¨é–‹', answer:'push away'},
  {prompt:'æ‹‰åœ¨ä¸€èµ·', answer:'pull together'}
];

let idx=0,score=0,totalCount=0,correctCount=0,isRecording=false;
const scoreEl=document.getElementById('score');
const accuracyEl=document.getElementById('accuracy');
const clue=document.getElementById('clue');
const feedback=document.getElementById('feedback');
const recBtn=document.getElementById('recBtn');
const startBtn=document.getElementById('startBtn');
const nextBtn=document.getElementById('nextBtn');
const playRefBtn=document.getElementById('playRef');
const rankBoard=document.getElementById('rankBoard');
const rankList=document.getElementById('rankList');
const toggleRank=document.getElementById('toggleRank');

// èªéŸ³è¾¨è­˜
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognition=null;

if(SpeechRecognition){
  recognition=new SpeechRecognition();
  recognition.lang='en-US';
  recognition.interimResults=false;
  recognition.maxAlternatives=1;

  recognition.addEventListener('result', e=>{
    const txt=e.results[0][0].transcript.trim().toLowerCase().replace(/ /g,'');
    const ref=qa[idx].answer.toLowerCase().replace(/ /g,'');
    let isCorrect = txt===ref;
    totalCount++;
    if(isCorrect){ correctCount++; score+=20; }
    feedback.innerHTML=`<div class="result ${isCorrect?'good':'bad'}">${isCorrect?'âœ… æ­£ç¢º':'âŒ éŒ¯èª¤'}</div><div>ä½ èªª: ${txt}</div>`;
    updateStats();
  });

  recognition.addEventListener('end', ()=>{
    isRecording=false;
    recBtn.textContent='æŒ‰ä¸‹èªªè©±';
  });

  recognition.addEventListener('error', e=>{
    console.error(e);
    feedback.innerHTML='âš ï¸ èªéŸ³è¾¨è­˜å¤±æ•—ï¼Œè«‹å†è©¦ä¸€æ¬¡';
    isRecording=false;
    recBtn.textContent='æŒ‰ä¸‹èªªè©±';
  });
} else {
  recBtn.disabled=true;
  recBtn.textContent='æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜';
}

// æ›´æ–°çµ±è¨ˆ
function updateStats(){
  scoreEl.textContent=score;
  const rate=Math.floor(totalCount>0? (correctCount/totalCount*100):0);
  accuracyEl.textContent=rate;
}

// é¡¯ç¤ºé¡Œç›®
function showQuestion(){
  const q=qa[idx];
  clue.innerHTML=`ä¸­æ–‡æç¤º: ${q.prompt} <br>è‹±æ–‡æç¤º: ${q.answer}`;
  feedback.innerHTML='';
}

// æ’­æ”¾å–®å­—
playRefBtn.addEventListener('click', ()=>{
  const text=qa[idx].answer;
  if('speechSynthesis' in window){
    const u=new SpeechSynthesisUtterance(text);
    u.lang='en-US';
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
  }
});

// é–‹å§‹æŒ‘æˆ°
startBtn.addEventListener('click', ()=>{
  idx=0; score=0; totalCount=0; correctCount=0;
  updateStats();
  showQuestion();
});

// éŒ„éŸ³
recBtn.addEventListener('click', ()=>{
  if(!recognition) return;
  if(!isRecording){
    recognition.start();
    isRecording=true;
    recBtn.textContent='éŒ„éŸ³ä¸­...å†æŒ‰ä¸€æ¬¡åœæ­¢';
  } else {
    recognition.stop();
  }
});

// ä¸‹ä¸€é¡Œ
nextBtn.addEventListener('click', ()=>{
  idx=(idx+1)%qa.length;
  showQuestion();
});

// æ’è¡Œæ¦œå­˜å–
function saveRank(name,sc){
  const recs=JSON.parse(localStorage.getItem('speaking_rank')||'[]');
  recs.push({name,sc,date:new Date().toLocaleString()});
  recs.sort((a,b)=>b.sc-a.sc);
  localStorage.setItem('speaking_rank',JSON.stringify(recs.slice(0,15)));
  renderRank();
}

function renderRank(){
  const recs=JSON.parse(localStorage.getItem('speaking_rank')||'[]');
  rankList.innerHTML=recs.map((r,i)=>`<li>No.${i+1} ${r.name}: ${r.sc}åˆ†</li>`).join('');
}

// æ’è¡Œæ¦œæ”¶åˆ
toggleRank.addEventListener('click', ()=>{rankBoard.classList.toggle('collapsed');});

// åˆå§‹åŒ–æ’è¡Œæ¦œ
renderRank();
</script>
</body>
</html>
