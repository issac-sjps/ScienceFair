<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
<title>å£èªªæŒ‘æˆ°ï¼ˆæ‰‹å‹•æ§åˆ¶ç‰ˆï¼‰</title>
<style>
:root{--bg:#0b1220;--accent:#6366f1;--good:#22c55e;--bad:#ef4444;--muted:#94a3b8}
*{box-sizing:border-box}
body{margin:0;font-family:'Segoe UI',sans-serif;background:linear-gradient(180deg,#0b1220 0%,#1e1b4b 100%);color:#fff;min-height:100vh;display:flex;flex-direction:column;align-items:center;text-align:center;}
.header-block{width:100%;padding:16px 24px;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(255,255,255,0.05);backdrop-filter:blur(8px);position:relative;z-index:10;}
.header-block h1{font-size:28px;margin:0 0 8px 0;}
.stats{display:flex;gap:16px;font-size:16px;color:var(--muted);margin-bottom:8px;}
#progressBar{height:8px;background:rgba(255,255,255,0.1);border-radius:10px;overflow:hidden;width:80%;margin:8px auto;}
#bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),#a78bfa);transition:width 0.3s;}
#rankBoard{width:90%;background:rgba(0,0,0,0.6);border-radius:12px;padding:0 0 12px 0;font-size:20px;margin-top:12px;max-height:200px;overflow-y:auto;transition:max-height 0.3s;}
#rankBoard.collapsed{max-height:40px;overflow:hidden;}
#rankBoard h3{margin:0;padding:8px 12px;font-size:22px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;}
#rankList{list-style:none;padding:0;margin:0;}
#rankList li{padding:4px 12px;}
main{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:16px;width:100%;max-width:800px;margin-top:40px;padding-bottom:120px;}
#clue{font-size:20px;color:var(--muted);}
.buttons{display:flex;gap:16px;margin-top:16px;}
button{background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.1);border-radius:10px;padding:10px 20px;color:#fff;font-size:18px;cursor:pointer;}
button.primary{background:linear-gradient(90deg,var(--accent),#7c3aed);border:none;}
.result{font-size:22px;margin-top:12px;padding:8px 16px;border-radius:10px;}
.result.good{background:rgba(34,197,94,0.15);color:var(--good);}
.result.bad{background:rgba(239,68,68,0.15);color:var(--bad);}
footer{width:100%;padding:12px;text-align:center;background:rgba(0,0,0,0.3);backdrop-filter:blur(8px);font-size:18px;color:var(--muted);margin-top:20px;}
</style>
</head>
<body>
<div class="header-block">
<h1>å£èªªæŒ‘æˆ°ï¼ˆæ‰‹å‹•ç‰ˆï¼‰</h1>
<div class="stats">
<div>åˆ†æ•¸ï¼š<span id="score">0</span></div>
<div>æ™‚é–“ï¼š<span id="timer">0</span> ç§’</div>
</div>
<div id="progressBar"><div id="bar"></div></div>
<div id="rankBoard" class="collapsed">
<h3>ğŸ† æ’è¡Œæ¦œ <span id="toggleRank">ğŸ“Œ</span></h3>
<ol id="rankList"></ol>
</div>
</div>

<main>
<div id="clue">è«‹æŒ‰é–‹å§‹æŒ‘æˆ°</div>
<div class="buttons">
<button id="startBtn" class="primary">é–‹å§‹æŒ‘æˆ°</button>
<button id="speakBtn">é–‹å§‹èªªè©± ğŸ”Š</button>
<button id="nextBtn">ä¸‹ä¸€é¡Œ â–¶ï¸</button>
</div>
<div id="feedback"></div>
</main>
<footer>â±ï¸ å£èªªæŒ‘æˆ° â€” iPad å…¨è¢å¹•éŠæˆ²ç‰ˆ</footer>

<script>
const items=[
{word:'magnet',zh:'ç£éµ'},
{word:'north pole',zh:'åŒ—æ¥µ'},
{word:'south pole',zh:'å—æ¥µ'},
{word:'push away',zh:'æ¨é–‹'},
{word:'pull together',zh:'æ‹‰åœ¨ä¸€èµ·'}
];

let idx=0,score=0,startTime=null,timerInt=null,correctCount=0,totalCount=0;
let recognizing=false;
const scoreEl=document.getElementById('score');
const timerEl=document.getElementById('timer');
const clue=document.getElementById('clue');
const feedback=document.getElementById('feedback');
const bar=document.getElementById('bar');
const rankList=document.getElementById('rankList');
const rankBoard=document.getElementById('rankBoard');
const toggleRank=document.getElementById('toggleRank');
const startBtn=document.getElementById('startBtn');
const speakBtn=document.getElementById('speakBtn');
const nextBtn=document.getElementById('nextBtn');

// èªéŸ³è¾¨è­˜
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognition=null;

if(SpeechRecognition){
    recognition=new SpeechRecognition();
    recognition.lang='en-US';
    recognition.interimResults=false;
    recognition.maxAlternatives=1;

    recognition.onresult=(event)=>{
        const spoken=event.results[0][0].transcript.toLowerCase().replace(/ /g,'');
        const correct=items[idx].word.toLowerCase().replace(/ /g,'');
        totalCount++;
        let isCorrect = false;
        if(spoken===correct){
            correctCount++;
            isCorrect=true;
            score+=20;
        }
        showFeedback(isCorrect);
        updateAccuracy();
    }

    recognition.onend=()=>{
        recognizing=false;
        speakBtn.textContent='é–‹å§‹èªªè©± ğŸ”Š';
    }

}else{
    alert('ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜ï¼Œè«‹ä½¿ç”¨ Chrome æˆ– Safari');
}

// æ’­æ”¾å–®å­—
function speakWord(t){
    if(!('speechSynthesis' in window)) return;
    const u=new SpeechSynthesisUtterance(t);
    u.lang='en-US';
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
}

// é–‹å§‹éŠæˆ²
function startGame(){
    idx=0;score=0;correctCount=0;totalCount=0;updateProgress();feedback.textContent='';
    startTime=Date.now();
    if(timerInt) clearInterval(timerInt);
    timerInt=setInterval(()=>{timerEl.textContent=Math.floor((Date.now()-startTime)/1000);},1000);
    nextQuestion();
}

// ä¸‹ä¸€é¡Œ
function nextQuestion(){
    if(idx>=items.length){finish(); return;}
    const it=items[idx];
    clue.innerHTML=`ä¸­æ–‡æç¤ºï¼š${it.zh} <br>è‹±æ–‡æç¤ºï¼š${it.word}`;
    feedback.textContent='';
    speakWord(it.word);
}

// åˆ‡æ›èªéŸ³è¾¨è­˜
function toggleRecognition(){
    if(!recognition) return;
    if(!recognizing){
        recognition.start();
        recognizing=true;
        speakBtn.textContent='åœæ­¢èªªè©± ğŸ”‡';
        feedback.textContent='ğŸ¤ æ­£åœ¨è¾¨è­˜...';
    }else{
        recognition.stop();
    }
}

// é¡¯ç¤ºç­”å°/éŒ¯èª¤
function showFeedback(ok){
    feedback.innerHTML=`<div class='result ${ok?'good':'bad'}'>${ok?'âœ… æ­£ç¢ºï¼':'âŒ éŒ¯èª¤ï¼'}</div>`;
}

// æ›´æ–°ç­”å°ç‡
function updateAccuracy(){
    const rate=((correctCount/totalCount)*100).toFixed(0);
    feedback.innerHTML+=`<div>ç­”å°ç‡ï¼š${rate}%</div>`;
}

// æ›´æ–°é€²åº¦èˆ‡åˆ†æ•¸
function updateProgress(){
    bar.style.width=(idx/items.length*100)+'%';
    scoreEl.textContent=score;
}

// å®ŒæˆæŒ‘æˆ°
function finish(){
    clearInterval(timerInt);
    const time=Math.floor((Date.now()-startTime)/1000);
    const name=prompt('æŒ‘æˆ°å®Œæˆï¼è«‹è¼¸å…¥åå­—ï¼š','Player');
    saveRank(name||'åŒ¿å',score,time);
    showRank();
    feedback.innerHTML=`<div class='result good'>ğŸ å®Œæˆï¼åˆ†æ•¸ ${score} ç”¨æ™‚ ${time} ç§’</div>`;
}

// æ’è¡Œæ¦œå­˜å–
function saveRank(name,sc,t){
    const recs=JSON.parse(localStorage.getItem('five_rank')||'[]');
    recs.push({name,sc,t,date:new Date().toLocaleString()});
    recs.sort((a,b)=>b.sc-a.sc || a.t-b.t);
    localStorage.setItem('five_rank',JSON.stringify(recs.slice(0,15)));
}

function showRank(){
    const recs=JSON.parse(localStorage.getItem('five_rank')||'[]');
    rankList.innerHTML=recs.map((r,i)=>`<li>No.${i+1} ${r.name}ï¼š${r.sc}åˆ† / ${r.t}s</li>`).join('');
}

// åˆ‡æ›æ’è¡Œæ¦œæ”¶åˆ
toggleRank.addEventListener('click',()=>{rankBoard.classList.toggle('collapsed');});

// æŒ‰éˆ•äº‹ä»¶
startBtn.onclick=startGame;
speakBtn.onclick=toggleRecognition;
nextBtn.onclick=()=>{
    idx++;
    nextQuestion();
    updateProgress();
}

// åˆå§‹åŒ–æ’è¡Œæ¦œ
showRank();
</script>
</body>
</html>
