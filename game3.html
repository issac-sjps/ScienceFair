<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ‹¼å­—æŒ‘æˆ° - è‡ªå‹•åˆ¤å®šç‰ˆ</title>
<style>
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(180deg,#0b1220,#1e1b4b);
  color:#fff;
}
.header-block{
  width:100%;
  padding:16px 24px;
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(8px);
  text-align:center;
}
.header-block h1{
  margin:0 0 8px 0;
}
.stats{
  display:flex;
  gap:16px;
  justify-content:center;
  margin-bottom:8px;
  color:#94a3b8;
}
#rankBoard{
  width:90%;
  background:rgba(0,0,0,0.6);
  border-radius:12px;
  padding:0 0 12px 0;
  margin:12px auto;
  max-height:180px;
  overflow-y:auto;
}
#rankBoard h3{
  margin:0;
  padding:8px 12px;
  font-size:22px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
#rankList{
  list-style:none;
  padding:0;
  margin:0;
}
#rankList li{
  padding:4px 12px;
}
main{
  display:flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap:16px;
  width: 100%;
  max-width:800px;
  padding-bottom:120px;
  margin:20px auto;
  text-align:center;
}
#clue{
  margin:16px 0;
  font-size:20px;
  color:#94a3b8;
}
#letterBank{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:8px;
  margin:8px 0;
}
.letter, .ansLetter{
  padding:10px 14px;
  background:linear-gradient(90deg,#6366f1,#a78bfa);
  border-radius:8px;
  cursor:pointer;
  user-select:none;
  font-size:20px;
  font-weight:bold;
}
#answerArea{
  min-height:40px;
  margin:12px 0;
  display:flex;
  justify-content:center;
  gap:8px;
}
button{
  padding:10px 20px;
  margin:4px;
  font-size:18px;
  border:none;
  border-radius:10px;
  background:linear-gradient(90deg,#f59e0b,#fbbf24);
  color:#000;
  cursor:pointer;
}
button:disabled{
  opacity:0.6;
  cursor:not-allowed;
}
.result{
  font-size:20px;
  margin-top:8px;
  padding:6px 12px;
  border-radius:10px;
}
.result.good{
  background:rgba(34,197,94,0.15);
  color:#22c55e;
}
.result.bad{
  background:rgba(239,68,68,0.15);
  color:#ef4444;
}
.button-group{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:8px;
}
.button-group .line-break{
  flex-basis:100%;
  height:0;
}
footer{
  width:100%;
  padding:12px;
  background:rgba(0,0,0,0.3);
  backdrop-filter:blur(8px);
}
</style>
</head>
<body>

<div class="header-block">
<h1>æ–°èŠåœ‹å°-æ‹¼å­—æŒ‘æˆ°</h1>
<div class="stats">åˆ†æ•¸ï¼š<span id="score">0</span> | ç­”å°ç‡ï¼š<span id="accuracy">0</span>% | æ™‚é–“ï¼š<span id="timer">0</span>s</div>
<div id="rankBoard">
<h3>ğŸ† æ’è¡Œæ¦œ</h3>
<ol id="rankList"></ol>
</div>
</div>

<main>
<div id="clue">è«‹æŒ‰ã€Œé–‹å§‹æŒ‘æˆ°ã€</div>
<div id="letterBank"></div>
<div id="answerArea"></div>
<div class="button-group">
<button id="startBtn">é–‹å§‹æŒ‘æˆ°</button>
<button id="nextBtn">é€²ä¸‹ä¸€é¡Œ</button>
<div class="line-break"></div>
<button id="playRef">æ’­æ”¾å–®å­—</button>
<button id="resetBtn">å­—å¡é‡ç½®</button>
</div>
<div id="feedback"></div>
</main>
<img src="https://issac-sjps.github.io/ScienceFair/logo.gif" alt="æ ¡å¾½" style="position: fixed; bottom: 1%; right: 1%; width: 15vw;height: auto;">
<footer>â±ï¸ æ‹¼å­—æŒ‘æˆ° â€” iPad å…¨è¢å¹•</footer>

<script>
// é¡Œåº«
const qa=[
  {prompt:'ç£éµ', answer:'magnet'},
  {prompt:'åŒ—æ¥µ', answer:'north pole'},
  {prompt:'å—æ¥µ', answer:'south pole'},
  {prompt:'æ¨é–‹', answer:'push away'},
  {prompt:'æ‹‰åœ¨ä¸€èµ·', answer:'pull together'}
];

let idx=0,score=0,totalCount=0,correctCount=0,startTime=0;
const scoreEl=document.getElementById('score');
const accuracyEl=document.getElementById('accuracy');
const timerEl=document.getElementById('timer');
const clue=document.getElementById('clue');
const letterBank=document.getElementById('letterBank');
const answerArea=document.getElementById('answerArea');
const feedback=document.getElementById('feedback');
const startBtn=document.getElementById('startBtn');
const nextBtn=document.getElementById('nextBtn');
const playRef=document.getElementById('playRef');
const resetBtn=document.getElementById('resetBtn');
const rankList=document.getElementById('rankList');
let timerInterval=null;

function shuffle(str){
  let arr=str.split('');
  for(let i=arr.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}

function updateStats(){
  scoreEl.textContent=score;
  const rate=Math.floor(totalCount>0? (correctCount/totalCount*100):0);
  accuracyEl.textContent=rate;
}

function speakWord(text){
  if('speechSynthesis' in window){
    const u=new SpeechSynthesisUtterance(text);
    u.lang='en-US';
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(u);
  }
}

let currentLetters=[];

function renderQuestion(){
  const q=qa[idx];
  feedback.innerHTML='';
  answerArea.innerHTML='';
  clue.innerHTML=`<div><strong>ä¸­æ–‡é¡Œæ˜¯:</strong> ${q.prompt}</div>`;
  speakWord(q.answer);
  currentLetters = shuffle(q.answer.replace(/ /g,''));
  renderLetterBank();
}

function renderLetterBank(){
  letterBank.innerHTML='';
  currentLetters.forEach(l=>{
    const btn=document.createElement('div');
    btn.className='letter';
    btn.textContent=l;
    btn.addEventListener('click', ()=>{
      const ansDiv=document.createElement('div');
      ansDiv.className='ansLetter';
      ansDiv.textContent=l;
      ansDiv.addEventListener('click', ()=>{
        answerArea.removeChild(ansDiv);
        btn.style.visibility='visible';
      });
      answerArea.appendChild(ansDiv);
      btn.style.visibility='hidden';
    });
    letterBank.appendChild(btn);
  });
}

// ä¸‹ä¸€é¡Œè‡ªå‹•åˆ¤å®šç­”æ¡ˆ
nextBtn.addEventListener('click', ()=>{
  const userAns = Array.from(answerArea.children).map(d=>d.textContent).join('').toLowerCase().trim();
  const ref = qa[idx].answer.replace(/ /g,'').toLowerCase().trim();
  totalCount++;
  let isCorrect = false;

  if(userAns === ref){
    correctCount++;
    score += 20;
    feedback.innerHTML = '<div class="result good">âœ… æ­£ç¢ºï¼</div>';
    isCorrect = true;
  } else {
    feedback.innerHTML = `<div class="result bad">âŒ éŒ¯èª¤ï¼æ­£ç¢ºç­”æ¡ˆ: ${qa[idx].answer}</div>`;
  }
  updateStats();

  // å¦‚æœç­”éŒ¯ï¼Œè·³å‡ºç¢ºèªæ˜¯å¦ç¹¼çºŒä¸‹ä¸€é¡Œ
  if(!isCorrect){
    const proceed = confirm('ç­”æ¡ˆä¸æ­£ç¢ºï¼Œæ˜¯å¦ä»ç„¶è·³åˆ°ä¸‹ä¸€é¡Œï¼Ÿ');
    if(!proceed) return; // åœç•™åœ¨é€™é¡Œ
  }

  idx++;
  if(idx>=qa.length){
    finishChallenge();
  } else {
    renderQuestion();
  }
});

startBtn.addEventListener('click', ()=>{
  idx=0; score=0; totalCount=0; correctCount=0; startTime=Date.now();
  updateStats();
  renderQuestion();
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{ timerEl.textContent=Math.floor((Date.now()-startTime)/1000); },1000);
});

playRef.addEventListener('click', ()=>{ speakWord(qa[idx].answer); });
resetBtn.addEventListener('click', ()=>{ renderQuestion(); });

function saveRank(name,sc,t){
  const recs=JSON.parse(localStorage.getItem('spelling_rank')||'[]');
  recs.push({name,sc,t,date:new Date().toLocaleString()});
  recs.sort((a,b)=>b.sc-a.sc || a.t-b.t);
  localStorage.setItem('spelling_rank',JSON.stringify(recs.slice(0,15)));
  renderRank();
}

function renderRank(){
  const recs=JSON.parse(localStorage.getItem('spelling_rank')||'[]');
  rankList.innerHTML=recs.map((r,i)=>`<li>No.${i+1} ${r.name}: ${r.sc}åˆ† / ${r.t}s</li>`).join('');
}

function finishChallenge(){
  clearInterval(timerInterval);
  const totalTime=Math.floor((Date.now()-startTime)/1000);
  const name=prompt(`æŒ‘æˆ°å®Œæˆï¼åˆ†æ•¸: ${score} åˆ†ï¼Œæ™‚é–“: ${totalTime} ç§’\nè«‹è¼¸å…¥åå­—:`,'Player');
  saveRank(name||'åŒ¿å',score,totalTime);
  idx=0; score=0; totalCount=0; correctCount=0;
  timerEl.textContent=0;
  updateStats();
  renderQuestion();
}

renderRank();
</script>
</body>
</html>
